<?php

/**
 * The header for our theme
 *
 * This is the template that displays all of the <head> section and everything up until <div id="content">
 *
 * @link https://developer.wordpress.org/themes/basics/template-files/#template-partials
 *
 * @package Theme
*/

$cart = WC()->cart->get_cart();

$logo = wp_get_attachment_image_url(theme('logo'), 'full');
$upper_header_text = theme('upper_header_text');

?>
<!doctype html>
<html <?php language_attributes(); ?>>


<head>
    <meta charset="<?php bloginfo('charset'); ?>">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="profile" href="https://gmpg.org/xfn/11">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hanken+Grotesk:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <?php wp_head(); ?>
</head>

<body <?php body_class(); ?>>
    <?php if ($upper_header_text != '') { ?>
        <div class="upper_header_text gray p5">
            <?= $upper_header_text ?>
        </div>
    <?php } ?>
    <header id="header" class="site-header <?= is_front_page() ? 'front transparent' : '' ?>">
        <div class="header <?= is_front_page() ? 'front transparent' : '' ?>">
            <div class="header-container">
                <div class="header__top">
                    <div class="burger open_menu">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 7H3C2.73478 7 2.48043 6.89464 2.29289 6.70711C2.10536 6.51957 2 6.26522 2 6C2 5.73478 2.10536 5.48043 2.29289 5.29289C2.48043 5.10536 2.73478 5 3 5H21C21.2652 5 21.5196 5.10536 21.7071 5.29289C21.8946 5.48043 22 5.73478 22 6C22 6.26522 21.8946 6.51957 21.7071 6.70711C21.5196 6.89464 21.2652 7 21 7ZM3 17H17C17.2652 17 17.5196 17.1054 17.7071 17.2929C17.8946 17.4804 18 17.7348 18 18C18 18.2652 17.8946 18.5196 17.7071 18.7071C17.5196 18.8946 17.2652 19 17 19H3C2.73478 19 2.48043 18.8946 2.29289 18.7071C2.10536 18.5196 2 18.2652 2 18C2 17.7348 2.10536 17.4804 2.29289 17.2929C2.48043 17.1054 2.73478 17 3 17ZM3 9H17C17.2652 9 17.5196 9.10536 17.7071 9.29289C17.8946 9.48043 18 9.73478 18 10C18 10.2652 17.8946 10.5196 17.7071 10.7071C17.5196 10.8946 17.2652 11 17 11H3C2.73478 11 2.48043 10.8946 2.29289 10.7071C2.10536 10.5196 2 10.2652 2 10C2 9.73478 2.10536 9.48043 2.29289 9.29289C2.48043 9.10536 2.73478 9 3 9ZM3 13H21C21.2652 13 21.5196 13.1054 21.7071 13.2929C21.8946 13.4804 22 13.7348 22 14C22 14.2652 21.8946 14.5196 21.7071 14.7071C21.5196 14.8946 21.2652 15 21 15H3C2.73478 15 2.48043 14.8946 2.29289 14.7071C2.10536 14.5196 2 14.2652 2 14C2 13.7348 2.10536 13.4804 2.29289 13.2929C2.48043 13.1054 2.73478 13 3 13Z" fill="white" />
                        </svg> 
                    </div>
                    <div class="center">
                        <?php if ($logo != '') { ?>
                            <a href="/" class="logo">
                                <img src="<?= $logo ?>" alt="">
                            </a>
                        <?php } ?>
                        <?php echo do_shortcode('[fibosearch]'); ?>
                    </div>
                    <div class="icons">
                        <?php echo do_shortcode('[fibosearch]'); ?>
                        <div class="search-toggler">
                            <div class="search">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M23.7068 22.2928L16.8818 15.4678C18.2038 13.8349 18.9998 11.7599 18.9998 9.49992C18.9998 4.26197 14.7378 0 9.49988 0C4.26193 0 0 4.26193 0 9.49988C0 14.7378 4.26197 18.9998 9.49992 18.9998C11.7599 18.9998 13.8349 18.2038 15.4678 16.8818L22.2928 23.7068C22.4878 23.9018 22.7438 23.9998 22.9998 23.9998C23.2558 23.9998 23.5118 23.9018 23.7068 23.7068C24.0978 23.3158 24.0978 22.6838 23.7068 22.2928ZM9.49992 16.9998C5.36395 16.9998 2 13.6359 2 9.49988C2 5.3639 5.36395 1.99995 9.49992 1.99995C13.6359 1.99995 16.9998 5.3639 16.9998 9.49988C16.9998 13.6359 13.6359 16.9998 9.49992 16.9998Z" fill="white" />
                                </svg>
                            </div>
                            <div class="close">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M13.7688 12.0002L21.6335 4.1352C21.7497 4.01911 21.8418 3.88126 21.9047 3.72952C21.9676 3.57778 22 3.41514 22 3.25088C22 3.08662 21.9676 2.92398 21.9047 2.77224C21.8418 2.6205 21.7497 2.48265 21.6335 2.36656C21.5174 2.25036 21.3795 2.15817 21.2278 2.09527C21.0761 2.03237 20.9134 2 20.7492 2C20.5849 2 20.4223 2.03237 20.2706 2.09527C20.1188 2.15817 19.981 2.25036 19.8649 2.36656L12.0002 10.2316L4.1351 2.36656C4.01902 2.25036 3.88117 2.15817 3.72944 2.09527C3.57771 2.03237 3.41507 2 3.25082 2C3.08658 2 2.92394 2.03237 2.77221 2.09527C2.62048 2.15817 2.48263 2.25036 2.36655 2.36656C2.25035 2.48265 2.15816 2.6205 2.09527 2.77224C2.03237 2.92398 2 3.08662 2 3.25088C2 3.41514 2.03237 3.57778 2.09527 3.72952C2.15816 3.88126 2.25035 4.01911 2.36655 4.1352L10.2317 12.0002L2.36655 19.8653C2.25045 19.9814 2.15836 20.1193 2.09554 20.271C2.03272 20.4227 2.0004 20.5853 2.00041 20.7496C2.00043 20.9138 2.0328 21.0764 2.09565 21.2281C2.15851 21.3798 2.25063 21.5176 2.36676 21.6337C2.48288 21.7498 2.62074 21.8419 2.77245 21.9047C2.92416 21.9676 3.08677 21.9999 3.25097 21.9999C3.41518 21.9999 3.57777 21.9675 3.72947 21.9046C3.88117 21.8418 4.019 21.7496 4.1351 21.6335L12.0002 13.7685L19.8649 21.6335C20.1092 21.8778 20.4294 22 20.7492 22C21.069 22 21.3891 21.8778 21.6335 21.6335C21.7497 21.5174 21.8418 21.3796 21.9047 21.2278C21.9676 21.0761 22 20.9135 22 20.7492C22 20.5849 21.9676 20.4223 21.9047 20.2706C21.8418 20.1188 21.7497 19.981 21.6335 19.8649L13.7688 12.0002Z" fill="white" />
                                </svg>
                            </div>
                        </div>
                        <div class="cart-btn">
                            <a href="<?= wc_get_cart_url(); ?>" class="woo-btn">
                                <div class="cart-count" id="cart-count"><?php echo WC()->cart->get_cart_contents_count(); ?></div>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19.3342 15.4366H9.11371C8.42271 15.4363 7.75313 15.2004 7.21872 14.7691C6.68432 14.3378 6.31806 13.7376 6.18217 13.0705L4.16798 3.16401H0.997123C0.73267 3.16401 0.479048 3.06057 0.292051 2.87645C0.105054 2.69232 0 2.4426 0 2.1822C0 1.92181 0.105054 1.67209 0.292051 1.48796C0.479048 1.30384 0.73267 1.2004 0.997123 1.2004H4.98562C5.21889 1.19576 5.44643 1.27182 5.62862 1.41534C5.81081 1.55886 5.93612 1.76074 5.98274 1.98584L8.13653 12.6876C8.18314 12.9127 8.30846 13.1145 8.49065 13.2581C8.67284 13.4016 8.90038 13.4776 9.13365 13.473H19.3342C19.5661 13.4781 19.7925 13.4034 19.9745 13.2618C20.1565 13.1203 20.2827 12.9207 20.3313 12.6974L21.9367 5.33381C21.9684 5.18882 21.9663 5.03864 21.9306 4.89457C21.8948 4.75049 21.8264 4.61625 21.7305 4.50193C21.6345 4.38761 21.5135 4.29618 21.3765 4.2345C21.2396 4.17283 21.0902 4.14251 20.9396 4.14582H10.9684C10.7039 4.14582 10.4503 4.04238 10.2633 3.85826C10.0763 3.67413 9.97123 3.42441 9.97123 3.16401C9.97123 2.90362 10.0763 2.65389 10.2633 2.46977C10.4503 2.28564 10.7039 2.1822 10.9684 2.1822H20.9396C21.3924 2.17191 21.8416 2.26299 22.2535 2.44858C22.6653 2.63416 23.029 2.9094 23.317 3.25354C23.6051 3.59768 23.81 4.00173 23.9164 4.43522C24.0227 4.86871 24.0277 5.32032 23.931 5.75599L22.3057 13.1196C22.1583 13.7843 21.7819 14.3782 21.2402 14.8006C20.6985 15.223 20.0251 15.4477 19.3342 15.4366ZM9.97123 22.8002C9.3796 22.8002 8.80125 22.6274 8.30932 22.3038C7.81739 21.9802 7.43398 21.5201 7.20757 20.9819C6.98116 20.4437 6.92192 19.8515 7.03734 19.2801C7.15276 18.7088 7.43766 18.184 7.85602 17.772C8.27437 17.3601 8.80738 17.0796 9.38765 16.9659C9.96792 16.8523 10.5694 16.9106 11.116 17.1335C11.6626 17.3565 12.1298 17.734 12.4585 18.2184C12.7872 18.7028 12.9626 19.2722 12.9626 19.8548C12.9626 20.6359 12.6474 21.3851 12.0865 21.9375C11.5255 22.4899 10.7646 22.8002 9.97123 22.8002ZM9.97123 18.873C9.77402 18.873 9.58124 18.9305 9.41726 19.0384C9.25329 19.1463 9.12548 19.2996 9.05001 19.479C8.97454 19.6584 8.9548 19.8559 8.99327 20.0463C9.03174 20.2368 9.12671 20.4117 9.26616 20.549C9.40561 20.6863 9.58328 20.7798 9.7767 20.8177C9.97013 20.8556 10.1706 20.8362 10.3528 20.7618C10.535 20.6875 10.6907 20.5617 10.8003 20.4002C10.9099 20.2388 10.9684 20.049 10.9684 19.8548C10.9684 19.5944 10.8633 19.3446 10.6763 19.1605C10.4893 18.9764 10.2357 18.873 9.97123 18.873ZM18.9453 22.8002C18.3537 22.8002 17.7754 22.6274 17.2834 22.3038C16.7915 21.9802 16.4081 21.5201 16.1817 20.9819C15.9553 20.4437 15.896 19.8515 16.0115 19.2801C16.1269 18.7088 16.4118 18.184 16.8301 17.772C17.2485 17.3601 17.7815 17.0796 18.3618 16.9659C18.942 16.8523 19.5435 16.9106 20.0901 17.1335C20.6367 17.3565 21.1039 17.734 21.4326 18.2184C21.7613 18.7028 21.9367 19.2722 21.9367 19.8548C21.9367 20.6359 21.6216 21.3851 21.0606 21.9375C20.4996 22.4899 19.7387 22.8002 18.9453 22.8002ZM18.9453 18.873C18.7481 18.873 18.5553 18.9305 18.3914 19.0384C18.2274 19.1463 18.0996 19.2996 18.0241 19.479C17.9487 19.6584 17.9289 19.8559 17.9674 20.0463C18.0059 20.2368 18.1008 20.4117 18.2403 20.549C18.3797 20.6863 18.5574 20.7798 18.7508 20.8177C18.9442 20.8556 19.1447 20.8362 19.3269 20.7618C19.5091 20.6875 19.6649 20.5617 19.7744 20.4002C19.884 20.2388 19.9425 20.049 19.9425 19.8548C19.9425 19.5944 19.8374 19.3446 19.6504 19.1605C19.4634 18.9764 19.2098 18.873 18.9453 18.873Z" fill="white" />
                                </svg>
                            </a>
                            <div class="cart-info">
                                <div class="cart-info__top">
                                    <div class="h4 title">
                                        cart
                                    </div>
                                    <a href="<?= wc_get_cart_url(); ?>" class="h6 link">
                                        view all
                                    </a>
                                </div>
                                <?php if (!empty($cart)) {
                                    $total_price = 0;
                                ?>
                                    <div class="products">
                                        <?php foreach ($cart as $item) {
                                            $product = $item['data'];
                                            $product_post = get_post($product->get_id());
                                            $image_id = $product->get_image_id();
                                            $image = wp_get_attachment_image_url($image_id, 'medium');
                                            $name = $product->get_name();
                                            $quantity = $item['quantity'];
                                            $amount_price = $item['line_subtotal'] ;
                                            $total_price += $amount_price;
                                            $price =  $product->get_price();
                                            $link = get_permalink($product_post);
                                        ?>
                                            <div class="cart-item">
                                                <div class="cart-item__image">
                                                    <?php if ($image != '') { ?>
                                                        <img src="<?= $image ?>" alt="">
                                                    <?php } ?>
                                                    <div class="quantity">
                                                        <?= $quantity ?>
                                                    </div>
                                                </div>
                                                <a href="<?= $link ?>" class="cart-item__center">
                                                    <div class="h6 name">
                                                        <?= $name ?>
                                                    </div>
                                                    <div class="info">
 
                                                        <div class="price p5">
                                                            $<?= number_format($price, 2, '.', ' ')  ?>
                                                        </div>
                                                        <div class="p5 gray quantity">
                                                            x<?= $quantity ?>
                                                        </div>
                                                    </div>
                                                </a>
                                                <div class="cart-item__price">
                                                    <div class="p3 amount-price">
                                                        $<?= number_format($amount_price, 2, '.', ' ')  ?>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } ?>
                                    </div>
                                <?php } ?>
                                <div class="cart-info__bottom">
                                    <div class="total">
                                        <div class="p1 count gray">
                                            products in cart: <?= WC()->cart->get_cart_contents_count(); ?>
                                        </div>
                                        <div class="p1 price">
                                            $<?= number_format($total_price, 2, '.', ' ')  ?>
                                        </div>
                                    </div>
                                    <a href="<?= wc_get_cart_url(); ?>" class="mini-btn-b link">
                                        view basket & checkout
                                    </a>
                                </div>
                            </div>
                        </div>
                        <a href="/favorites" class="favorite-btn">
                            <div class="woo-btn">
                                <span class="cart-count count"><?= WCFAVORITES()->count_items(); ?></span>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M22.0718 3.19898C19.4616 0.53403 15.2154 0.53403 12.6059 3.19898L11.9998 3.8176L11.394 3.19898C8.78455 0.533669 4.53795 0.533669 1.92847 3.19898C-0.628032 5.80982 -0.644633 9.94828 1.88997 12.8257C4.2017 15.4492 11.0196 21.117 11.3089 21.3569C11.4974 21.5139 11.7332 21.5996 11.9765 21.5993L11.9994 21.599C12.2424 21.6105 12.4872 21.5254 12.6899 21.3569C12.9792 21.117 19.7979 15.4492 22.1103 12.8253C24.6445 9.94828 24.6279 5.80982 22.0718 3.19898ZM20.535 11.3778C18.7326 13.4227 13.7782 17.6401 11.9994 19.1367C10.2207 17.6405 5.26732 13.4234 3.46527 11.3782C1.69712 9.37114 1.68052 6.51285 3.42677 4.72949C4.31861 3.81905 5.48984 3.36346 6.66107 3.36346C7.8323 3.36346 9.00354 3.81868 9.89538 4.72949L11.2277 6.0901C11.3819 6.24672 11.5809 6.34917 11.796 6.38263C11.9694 6.42102 12.1495 6.4144 12.3198 6.36335C12.4901 6.31231 12.6452 6.21849 12.7708 6.09046L14.1038 4.72949C15.8879 2.90824 18.7898 2.90861 20.5728 4.72949C22.319 6.51285 22.3024 9.37114 20.535 11.3778Z" fill="white" />
                                </svg>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-bottom">
            <?php
            wp_nav_menu([
                'theme_location'  => 'TopCatalog',
                'container'       => false,
                'menu'            => '',
                'menu_class'      => 'menuTop',
                'echo'            => true,
                'fallback_cb'     => 'wp_page_menu',
                'items_wrap'      => '<ul id="%1$s" class="%2$s">%3$s</ul>',
                'depth'           => 2,
            ]);
            ?>
        </div>
        <div id="mobile-mnu">
            <div class="mobile-top">
                <a href="/" class="h4">
                    menu
                </a>
                <div id="close-mnu">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19.65 3L12 9.79892L4.35 3L2 5.09312L12 14L22 5.09312L19.65 3Z" fill="#1B1B1B" />
                        <path d="M4.35 21L12 14.2011L19.65 21L22 18.9069L12 10L2 18.9069L4.35 21Z" fill="#1B1B1B" />
                    </svg>
                </div>
            </div>
            <?php
            wp_nav_menu([
                'theme_location'  => 'mobileMenu',
                'container'       => false,
                'menu'            => '',
                'menu_class'      => 'menuTop',
                'echo'            => true,
                'fallback_cb'     => 'wp_page_menu',
                'items_wrap'      => '<ul id="%1$s" class="%2$s">%3$s</ul>',
                'depth'           => 2,
            ]);
            ?>
        </div>
    </header>